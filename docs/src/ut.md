# Unscented transform

The unscented transform that underpins the [`UnscentedKalmanFilter`](@ref) may be tuned to adjust the spread of the points. By default, [`TrivialParams`](@ref) are used, but one may also opt for the [`WikiParams`](@ref) or [`MerweParams`](@ref) which are more commonly used in the literature.

The code snippets below demonstrate how to create different sets of parameters and visualizes the sigma points generated by each set of parameters for a trivial normal 2D distribution, as well has how the points propagate through a simple function.



## Tuning parameters

We start by visualizing the sigma points generated by the different parameters sets using their default parameters.
```@example UT
using LowLevelParticleFilters, Plots
using LowLevelParticleFilters: sigmapoints
Plots.default(fillalpha=0.2) # This makes the covariance ellipse more transparent
kwargs = (; markersize=4, markeralpha=0.7)
μ = [0.0, 0.0]
Σ = [1.0 0.0; 0.0 1.0]
wpars = WikiParams(α = 1, β = 0.0, κ = 1)
wxs = sigmapoints(μ, Σ, wpars)

mpars = MerweParams(α = 1e-3, β = 2.0, κ = 0.0)
mxs = sigmapoints(μ, Σ, mpars)

tpars = TrivialParams()
txs = sigmapoints(μ, Σ, tpars)

unscentedplot(wxs, wpars; lab="Wiki", c=:green, kwargs...)
unscentedplot!(mxs, mpars; lab="Merwe", c=:red, kwargs...)
unscentedplot!(txs, tpars; lab="Trivial", c=:blue, kwargs...)
```
In this plot, we hardly see the Merwe points because they are all very close to the origin due to the small default value of `α`. The Wiki points are more spread out, and the Trivial points are the most spread out. They all represent exactly the same distribution though, all their covariance ellipses overlap. Different sets of points can represent the same probability distribution by means of different weights that are assigned to each point.

Below, we demonstrate how the points propagate through a simple function. We use the function $f(x) = [\max(0, x[1]), x[2]]$ which is a simple function that forces the first state component to be positive.


```@example UT
f(x) = [max(zero(x[1]), x[1]), x[2]]
wxs2 = f.(wxs) # Propagate the points through the function
mxs2 = f.(mxs)
txs2 = f.(txs)
unscentedplot(wxs2, wpars; lab="Wiki", c=:green ,kwargs...)
unscentedplot!(mxs2, mpars; lab="Merwe", c=:red ,kwargs...)
unscentedplot!(txs2, tpars; lab="Trivial", c=:blue ,kwargs...)
```

We now see that the Merwe points resulted in an enormous covariance of the output, so large that the covariance ellipse for the other parameter sets aren't even visible in the plot. If we constrain the x-limits of the plot, we can have a better view of the other parameter sets
```@example UT
plot!(xlims=(-0.5, 2.5)) 
```
Here, we see that the posterior mean is skewed positively due to the clamping of ``f``, but the mean is skewed less for the trivial parameters than the Wiki parameters. 

By tweaking the parameters, we can obtain different behavior, below we show the spread of the points for different values of ``α, β, κ``

```@example UT
wpars = WikiParams(α = 5, β = -3.0, κ = 1)
wxs = sigmapoints(μ, Σ, wpars)

mpars = MerweParams(α = 2, β = -3.0, κ = 4.0)
mxs = sigmapoints(μ, Σ, mpars)

unscentedplot(wxs, wpars; lab="Wiki", c=:green, kwargs...)
unscentedplot!(mxs, mpars; lab="Merwe", c=:red, kwargs...)
unscentedplot!(txs, tpars; lab="Trivial", c=:blue, kwargs...)
```
This time, the Wiki and Merwe parameters are much more spread out than the Trivial parameters. When we propagate these points through the function:

```@example UT
wxs2 = f.(wxs)
mxs2 = f.(mxs)
txs2 = f.(txs)
unscentedplot(wxs2, wpars; lab="Wiki", c=:green, kwargs...)
unscentedplot!(mxs2, mpars; lab="Merwe", c=:red, kwargs...)
unscentedplot!(txs2, tpars; lab="Trivial", c=:blue, kwargs...)
```
we see that the Merwe parameters produced in a posterior mean closest to zero, but the Wiki parameters resulted in the smallest covariance estimate.