<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Performance tips · LowLevelParticleFilters Documentation</title><meta name="title" content="Performance tips · LowLevelParticleFilters Documentation"/><meta property="og:title" content="Performance tips · LowLevelParticleFilters Documentation"/><meta property="twitter:title" content="Performance tips · LowLevelParticleFilters Documentation"/><meta name="description" content="Documentation for LowLevelParticleFilters Documentation."/><meta property="og:description" content="Documentation for LowLevelParticleFilters Documentation."/><meta property="twitter:description" content="Documentation for LowLevelParticleFilters Documentation."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LowLevelParticleFilters Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../discretization/">Discretization</a></li><li><a class="tocitem" href="../measurement_models/">Multiple measurement models</a></li><li><a class="tocitem" href="../parameter_estimation/">Parameter estimation</a></li><li><a class="tocitem" href="../benchmark/">Benchmark</a></li><li class="is-active"><a class="tocitem" href>Performance tips</a><ul class="internal"><li><a class="tocitem" href="#Analysis-using-JET"><span>Analysis using JET</span></a></li><li class="toplevel"><a class="tocitem" href="#High-performance-Distributions"><span>High performance Distributions</span></a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../adaptive_kalmanfilter/">Kalman-filter tutorial with LowLevelParticleFilters</a></li><li><a class="tocitem" href="../noisetuning/">Noise tuning and disturbance modeling for Kalman filtering</a></li><li><a class="tocitem" href="../beetle_example/">Particle-filter tutorial</a></li><li><a class="tocitem" href="../beetle_example_imm/">IMM-filter tutorial</a></li><li><a class="tocitem" href="../dae/">State estimation for DAE systems</a></li><li><a class="tocitem" href="../neural_network/">Adaptive Neural-Network training</a></li><li><a class="tocitem" href="../fault_detection/">Fault detection</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Performance tips</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Performance tips</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/baggepinnen/LowLevelParticleFilters.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/baggepinnen/LowLevelParticleFilters.jl/blob/master/docs/src/distributions.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Performance-tips"><a class="docs-heading-anchor" href="#Performance-tips">Performance tips</a><a id="Performance-tips-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-tips" title="Permalink"></a></h1><p>Use of <a href="https://github.com/JuliaArrays/StaticArrays.jl">StaticArrays.jl</a> is recommended for optimal performance when the state dimension is small, e.g., less than about 10-15 for Kalman filters and less than about 100 for particle filters. In the section <a href="https://baggepinnen.github.io/LowLevelParticleFilters.jl/dev/parameter_estimation/#Using-an-optimizer">Parameter optimization</a> we demonstrate one workflow that makes use of StaticArrays everywhere it is needed for an <a href="../api/#LowLevelParticleFilters.UnscentedKalmanFilter-Union{Tuple{AUGM}, Tuple{AUGD}, Tuple{IPM}, Tuple{IPD}, Tuple{Any, LowLevelParticleFilters.AbstractMeasurementModel, Any}, Tuple{Any, LowLevelParticleFilters.AbstractMeasurementModel, Any, Any}} where {IPD, IPM, AUGD, AUGM}"><code>UnscentedKalmanFilter</code></a> in order to get a completely allocation free filter. The following arrays must be static for this to hold</p><ul><li>The initial state distribution (the vector and matrix passed to <code>d0 = MvNormal(μ, Σ)</code> for Kalman filters). If you are performing parameter optimization with gradients derived using ForwardDiff.jl, these must further have the correct element type. How to achieve this is demonstrated in the liked example above.</li><li>Inputs <code>u</code> measured outputs <code>y</code>.</li><li>In case of Kalman filters, the dynamic model matrices <code>A</code>, <code>B</code>, <code>C</code>, <code>D</code> and the covariance matrices <code>R1</code>, <code>R2</code>.</li><li>The dynamics functions for <a href="../api/#LowLevelParticleFilters.UnscentedKalmanFilter-Union{Tuple{AUGM}, Tuple{AUGD}, Tuple{IPM}, Tuple{IPD}, Tuple{Any, LowLevelParticleFilters.AbstractMeasurementModel, Any}, Tuple{Any, LowLevelParticleFilters.AbstractMeasurementModel, Any, Any}} where {IPD, IPM, AUGD, AUGM}"><code>UnscentedKalmanFilter</code></a> and particle filters must further return static arrays when passed static arrays as inputs.</li></ul><h2 id="Analysis-using-JET"><a class="docs-heading-anchor" href="#Analysis-using-JET">Analysis using JET</a><a id="Analysis-using-JET-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis-using-JET" title="Permalink"></a></h2><p>All flavors of Kalman filters are analyzed for potential runtime dispatch using <a href="https://github.com/aviatesk/JET.jl">JET.jl</a>. This analysis is performed <a href="https://github.com/baggepinnen/LowLevelParticleFilters.jl/blob/master/test/test_jet.jl">in the tests</a> and generally requires a completely static filter using static arrays internally. See the tests for an example of how to set a filter up this way.</p><h1 id="High-performance-Distributions"><a class="docs-heading-anchor" href="#High-performance-Distributions">High performance Distributions</a><a id="High-performance-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#High-performance-Distributions" title="Permalink"></a></h1><p>When <code>using LowLevelParticleFilters</code>, a number of methods related to distributions are defined for static arrays, making <code>logpdf</code> etc. faster. We also provide a new kind of distribution: <code>TupleProduct &lt;: MultivariateDistribution</code> that behaves similarly to the <code>Product</code> distribution. The <code>TupleProduct</code> however stores the individual distributions in a tuple, has compile-time known length and supports <code>Mixed &lt;: ValueSupport</code>, meaning that it can be a product of both <code>Continuous</code> and <code>Discrete</code> dimensions, something not supported by the standard <code>Product</code>. Example</p><pre><code class="language-julia hljs">using BenchmarkTools, LowLevelParticleFilters, Distributions, StaticArrays
dt = TupleProduct((Normal(0,2), Normal(0,2), Binomial())) # Mixed value support</code></pre><p>A small benchmark</p><pre><code class="language-julia hljs">sv = @SVector randn(2)
d = Distributions.Product([Normal(0,2), Normal(0,2)])
dt = TupleProduct((Normal(0,2), Normal(0,2)))
dm = MvNormal(2, 2)
@btime logpdf($d,$(Vector(sv)))  # 19.536 ns (0 allocations: 0 bytes)
@btime logpdf($dt,$(Vector(sv))) # 13.742 ns (0 allocations: 0 bytes)
@btime logpdf($dm,$(Vector(sv))) # 11.392 ns (0 allocations: 0 bytes)</code></pre><pre><code class="language-julia hljs">@btime logpdf($d,$sv)  # 13.964 ns (0 allocations: 0 bytes)
@btime logpdf($dt,$sv) # 12.817 ns (0 allocations: 0 bytes)
@btime logpdf($dm,$sv) # 8.383  ns (0 allocations: 0 bytes)</code></pre><p>Without loading <code>LowLevelParticleFilters</code>, the timing for the native distributions are the following</p><pre><code class="language-julia hljs">@btime logpdf($d,$sv)  # 18.040 ns (0 allocations: 0 bytes)
@btime logpdf($dm,$sv) # 9.938  ns (0 allocations: 0 bytes)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../benchmark/">« Benchmark</a><a class="docs-footer-nextpage" href="../adaptive_kalmanfilter/">Kalman-filter tutorial with LowLevelParticleFilters »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 25 December 2024 10:21">Wednesday 25 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
